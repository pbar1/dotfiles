#!/usr/bin/env bash

set -euo pipefail

function main() {
  local pod
  local container
  local shell

  pod="$(kubectl get pod -o json | jq -r '.items[].metadata.name' | fzf --preview='kubectl describe pod {}' --preview-window=70%)"
  container="$(kubectl get pod "${pod}" -o json | jq -r '.spec.containers[].name' | fzf)"
  shell="$(kubectl exec "${pod}" --container="${container}" -- cat /etc/shells | grep -v '^#' | fzf)"

  kubectl exec "${pod}" --container="${container}" --stdin --tty -- "${shell}"
}

main
