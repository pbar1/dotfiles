#!/usr/bin/env python3

import argparse
import subprocess
import json


def op_check_authenticated() -> bool:
    """Checks whether the current shell session is authenticated to 1Password"""
    try:
        subprocess.run(["op", "whoami"], check=True)
    except:
        return False
    return True


def op_get_user_ca() -> str:
    """Gets the SSH user CA from 1Password"""

    subprocess.run(["op", "item", "get", "pbcloud_user_ca_rsa", "--format=json", "--fields=ssh.private_key"])

    pass


def op_get_host_ca() -> str:
    """Gets the SSH host CA from 1Password"""
    pass


def generate_user_cert():
    pass


def main() -> None:
    parser = argparse.ArgumentParser(description="Lightweight tool to get SSH certificates")
    parser.add_argument("--user", help="Get a user scoped cert")
    parser.add_argument("--host", help="Get a host scoped cert")
    parser.add_argument("--principals", help="Principals (user or host names)")
    parser.add_argument("--validity", help="Validity interval for cert", default="+1d")
    args = parser.parse_args()


if __name__ == "__main__":
    main()
