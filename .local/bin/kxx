#!/usr/bin/env bash

# usage: kxx
# list/select pod, then containers in that pod, then shells in that container, then attach to the selected shell in that container
function kxx() {
  local pod container shell

  pod="$(kubectl get pods --output='jsonpath={range .items[*]}{.metadata.name}{"\n"}{end}' | fzf --exact --preview 'kubectl describe pod {}')"
  container="$(kubectl get pod "${pod}" --output='jsonpath={range .spec.containers[*]}{.name}{"\n"}{end}' | fzf --exact)"
  shell="$(kubectl exec "${pod}" --container="${container}" -- cat /etc/shells | fzf --exact)"

  kubectl exec "${pod}" --container="${container}" --stdin --tty -- "${shell}"
}

kxx
